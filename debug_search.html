<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Search - TICS Store</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .debug-input { padding: 10px; width: 300px; margin: 10px 0; }
        .debug-results { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .suggestion { padding: 5px; border-bottom: 1px solid #ddd; cursor: pointer; }
        .suggestion:hover { background: #e0e0e0; }
    </style>
</head>
<body>
    <h1>üîç Debug Search Functionality</h1>

    <div class="debug-section">
        <h2>1. Test Search Input</h2>
        <input type="text" id="search-input" class="debug-input" placeholder="Escribe 'phone' aqu√≠...">
        <div id="search-suggestions" class="debug-results"></div>
        <div id="debug-info" class="debug-results"></div>
    </div>

    <div class="debug-section">
        <h2>2. Manual Test</h2>
        <button onclick="testSearch()">Test Search Function</button>
        <button onclick="testProducts()">Test Products Data</button>
        <button onclick="testElements()">Test DOM Elements</button>
        <div id="manual-results" class="debug-results"></div>
    </div>

    <div class="debug-section">
        <h2>3. Products Data</h2>
        <div id="products-info" class="debug-results">Loading...</div>
    </div>

    <script>
        // Simple debug functions
        function log(message) {
            console.log(message);
            const debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML += '<div>' + JSON.stringify(message) + '</div>';
        }

        function testSearch() {
            const results = document.getElementById('manual-results');

            if (typeof window.SearchManager !== 'undefined') {
                results.innerHTML = '<div>‚úÖ SearchManager exists</div>';

                if (window.SearchManager.searchProducts) {
                    const searchResults = window.SearchManager.searchProducts('phone');
                    results.innerHTML += '<div>Search results for "phone": ' + searchResults.length + '</div>';
                    results.innerHTML += '<div>' + JSON.stringify(searchResults.slice(0, 2), null, 2) + '</div>';
                } else {
                    results.innerHTML += '<div>‚ùå searchProducts function not found</div>';
                }
            } else {
                results.innerHTML = '<div>‚ùå SearchManager not found</div>';
            }
        }

        function testProducts() {
            const results = document.getElementById('manual-results');

            if (window.productsData) {
                results.innerHTML = '<div>‚úÖ productsData exists: ' + window.productsData.length + ' products</div>';
                results.innerHTML += '<div>First product: ' + (window.productsData[0]?.title || 'N/A') + '</div>';
            } else {
                results.innerHTML = '<div>‚ùå productsData not found</div>';

                if (window.ProductsManager) {
                    results.innerHTML += '<div>But ProductsManager exists, trying to load...</div>';
                    window.ProductsManager.loadProducts().then(() => {
                        results.innerHTML += '<div>Products loaded, check again</div>';
                    });
                } else {
                    results.innerHTML += '<div>‚ùå ProductsManager also not found</div>';
                }
            }
        }

        function testElements() {
            const results = document.getElementById('manual-results');
            const input = document.getElementById('search-input');
            const suggestions = document.getElementById('search-suggestions');

            results.innerHTML = `
                <div>Input element: ${input ? '‚úÖ Found' : '‚ùå Not found'}</div>
                <div>Suggestions element: ${suggestions ? '‚úÖ Found' : '‚ùå Not found'}</div>
                <div>Input value: "${input?.value || 'N/A'}"</div>
            `;
        }

        // Load all the required scripts
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Load scripts in order
        async function loadAllScripts() {
            try {
                await loadScript('js/main.js');
                log('‚úÖ main.js loaded');

                await loadScript('js/products.js');
                log('‚úÖ products.js loaded');

                await loadScript('js/search.js');
                log('‚úÖ search.js loaded');

                // Wait a bit for initialization
                setTimeout(() => {
                    log('All scripts loaded, checking status...');

                    // Show products info
                    const productsInfo = document.getElementById('products-info');
                    if (window.productsData) {
                        productsInfo.innerHTML = `
                            <div>‚úÖ Products loaded: ${window.productsData.length}</div>
                            <div>Sample products:</div>
                            ${window.productsData.slice(0, 3).map(p =>
                                `<div>- ${p.title} (${p.category})</div>`
                            ).join('')}
                        `;
                    } else {
                        productsInfo.innerHTML = '‚ùå No products data available';
                    }
                }, 1000);

            } catch (error) {
                log('‚ùå Error loading scripts: ' + error.message);
            }
        }

        // Start loading
        loadAllScripts();

        // Add search input listener
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('search-input');
            if (input) {
                input.addEventListener('input', (e) => {
                    log(`Input changed: "${e.target.value}"`);

                    if (window.SearchManager && window.SearchManager.searchProducts) {
                        const results = window.SearchManager.searchProducts(e.target.value);
                        log(`Search results: ${results.length}`);

                        const suggestions = document.getElementById('search-suggestions');
                        if (suggestions && results.length > 0) {
                            suggestions.innerHTML = results.slice(0, 5).map(product =>
                                `<div class="suggestion">${product.title} (${product.category})</div>`
                            ).join('');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>